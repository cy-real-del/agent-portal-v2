<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Portal v2 - Enhanced</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Leaflet CSS –¥–ª—è –∫–∞—Ä—Ç—ã -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <style>
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .map-container {
            height: 400px;
            border-radius: 8px;
            overflow: hidden;
        }
        .selection-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            z-index: 10;
        }
        .filter-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="min-h-screen bg-gray-50 flex items-center justify-center">
            <div class="text-center">
                <h1 class="text-3xl font-bold text-gray-900 mb-4">Agent Portal v2</h1>
                <p class="text-gray-600 mb-4">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏...</p>
                <div class="animate-pulse w-8 h-8 bg-blue-500 rounded-full mx-auto"></div>
            </div>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // API Configuration
        const API_CONFIG = {
            baseUrl: window.location.hostname === 'localhost' 
                ? 'http://localhost:8000/api'
                : 'https://cy-real-portal-api.onrender.com/api'
        };

        // Map Component
        const MapComponent = ({ properties, selectedProperty, onPropertySelect }) => {
            const mapRef = useRef(null);
            const mapInstanceRef = useRef(null);
            const markersRef = useRef([]);

            useEffect(() => {
                if (!mapRef.current) return;

                // Initialize map
                mapInstanceRef.current = L.map(mapRef.current).setView([34.9, 33.2], 8);

                // Add tile layer
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors'
                }).addTo(mapInstanceRef.current);

                return () => {
                    if (mapInstanceRef.current) {
                        mapInstanceRef.current.remove();
                        mapInstanceRef.current = null;
                    }
                };
            }, []);

            useEffect(() => {
                if (!mapInstanceRef.current || !properties.length) return;

                // Clear existing markers
                markersRef.current.forEach(marker => {
                    mapInstanceRef.current.removeLayer(marker);
                });
                markersRef.current = [];

                // Add new markers
                properties.forEach(property => {
                    if (property.coordinates?.lat && property.coordinates?.lng) {
                        const isSelected = selectedProperty?.id === property.id;
                        
                        const marker = L.marker([property.coordinates.lat, property.coordinates.lng])
                            .addTo(mapInstanceRef.current)
                            .bindPopup(`
                                <div class="p-2">
                                    <h3 class="font-semibold text-sm">${property.title}</h3>
                                    <p class="text-blue-600 font-bold">‚Ç¨${property.price?.toLocaleString()}</p>
                                    <p class="text-gray-600 text-xs">${property.city || property.region}</p>
                                </div>
                            `)
                            .on('click', () => {
                                onPropertySelect(property);
                            });

                        if (isSelected) {
                            marker.openPopup();
                        }

                        markersRef.current.push(marker);
                    }
                });

                // Fit bounds if we have markers
                if (markersRef.current.length > 0) {
                    const group = new L.featureGroup(markersRef.current);
                    mapInstanceRef.current.fitBounds(group.getBounds().pad(0.1));
                }
            }, [properties, selectedProperty]);

            return React.createElement('div', {
                ref: mapRef,
                className: 'map-container w-full'
            });
        };

        // Filter Component
        const FilterPanel = ({ filters, onFiltersChange, onReset, stats }) => {
            const handleFilterChange = (key, value) => {
                onFiltersChange({
                    ...filters,
                    [key]: value
                });
            };

            return React.createElement('div', {
                className: 'filter-section text-white p-6 rounded-lg mb-6'
            }, [
                React.createElement('h3', {
                    key: 'title',
                    className: 'text-xl font-semibold mb-4 flex items-center'
                }, [
                    React.createElement('svg', {
                        key: 'icon',
                        className: 'w-5 h-5 mr-2',
                        fill: 'currentColor',
                        viewBox: '0 0 20 20'
                    }, React.createElement('path', {
                        fillRule: 'evenodd',
                        d: 'M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z',
                        clipRule: 'evenodd'
                    })),
                    '–§–∏–ª—å—Ç—Ä—ã –ø–æ–∏—Å–∫–∞'
                ]),

                React.createElement('div', {
                    key: 'filters',
                    className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4'
                }, [
                    // Search input
                    React.createElement('div', {
                        key: 'search'
                    }, [
                        React.createElement('label', {
                            key: 'label',
                            className: 'block text-sm font-medium mb-2'
                        }, '–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é'),
                        React.createElement('input', {
                            key: 'input',
                            type: 'text',
                            placeholder: '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ...',
                            value: filters.search || '',
                            onChange: (e) => handleFilterChange('search', e.target.value),
                            className: 'w-full px-3 py-2 border border-gray-300 rounded-md text-gray-900 focus:ring-2 focus:ring-blue-400'
                        })
                    ]),

                    // Property type
                    React.createElement('div', {
                        key: 'type'
                    }, [
                        React.createElement('label', {
                            key: 'label',
                            className: 'block text-sm font-medium mb-2'
                        }, '–¢–∏–ø –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏'),
                        React.createElement('select', {
                            key: 'select',
                            value: filters.type || '',
                            onChange: (e) => handleFilterChange('type', e.target.value),
                            className: 'w-full px-3 py-2 border border-gray-300 rounded-md text-gray-900 focus:ring-2 focus:ring-blue-400'
                        }, [
                            React.createElement('option', { key: 'all', value: '' }, '–í—Å–µ —Ç–∏–ø—ã'),
                            React.createElement('option', { key: 'apartment', value: 'apartment' }, '–ö–≤–∞—Ä—Ç–∏—Ä–∞'),
                            React.createElement('option', { key: 'villa', value: 'villa' }, '–í–∏–ª–ª–∞'),
                            React.createElement('option', { key: 'house', value: 'house' }, '–î–æ–º'),
                            React.createElement('option', { key: 'studio', value: 'studio' }, '–°—Ç—É–¥–∏—è'),
                            React.createElement('option', { key: 'land', value: 'land' }, '–£—á–∞—Å—Ç–æ–∫')
                        ])
                    ]),

                    // Region
                    React.createElement('div', {
                        key: 'region'
                    }, [
                        React.createElement('label', {
                            key: 'label',
                            className: 'block text-sm font-medium mb-2'
                        }, '–†–µ–≥–∏–æ–Ω'),
                        React.createElement('select', {
                            key: 'select',
                            value: filters.region || '',
                            onChange: (e) => handleFilterChange('region', e.target.value),
                            className: 'w-full px-3 py-2 border border-gray-300 rounded-md text-gray-900 focus:ring-2 focus:ring-blue-400'
                        }, [
                            React.createElement('option', { key: 'all', value: '' }, '–í—Å–µ —Ä–µ–≥–∏–æ–Ω—ã'),
                            React.createElement('option', { key: 'limassol', value: 'Limassol' }, '–õ–∏–º–∞—Å—Å–æ–ª'),
                            React.createElement('option', { key: 'paphos', value: 'Paphos' }, '–ü–∞—Ñ–æ—Å'),
                            React.createElement('option', { key: 'nicosia', value: 'Nicosia' }, '–ù–∏–∫–æ—Å–∏—è'),
                            React.createElement('option', { key: 'larnaca', value: 'Larnaca' }, '–õ–∞—Ä–Ω–∞–∫–∞'),
                            React.createElement('option', { key: 'famagusta', value: 'Famagusta' }, '–§–∞–º–∞–≥—É—Å—Ç–∞')
                        ])
                    ]),

                    // Price range
                    React.createElement('div', {
                        key: 'price'
                    }, [
                        React.createElement('label', {
                            key: 'label',
                            className: 'block text-sm font-medium mb-2'
                        }, '–¶–µ–Ω–∞ –¥–æ'),
                        React.createElement('select', {
                            key: 'select',
                            value: filters.maxPrice || '',
                            onChange: (e) => handleFilterChange('maxPrice', e.target.value),
                            className: 'w-full px-3 py-2 border border-gray-300 rounded-md text-gray-900 focus:ring-2 focus:ring-blue-400'
                        }, [
                            React.createElement('option', { key: 'all', value: '' }, '–õ—é–±–∞—è —Ü–µ–Ω–∞'),
                            React.createElement('option', { key: '200k', value: '200000' }, '‚Ç¨200,000'),
                            React.createElement('option', { key: '300k', value: '300000' }, '‚Ç¨300,000'),
                            React.createElement('option', { key: '500k', value: '500000' }, '‚Ç¨500,000'),
                            React.createElement('option', { key: '750k', value: '750000' }, '‚Ç¨750,000'),
                            React.createElement('option', { key: '1m', value: '1000000' }, '‚Ç¨1,000,000')
                        ])
                    ])
                ]),

                // Action buttons
                React.createElement('div', {
                    key: 'actions',
                    className: 'flex gap-3 mt-4'
                }, [
                    React.createElement('button', {
                        key: 'reset',
                        onClick: onReset,
                        className: 'px-4 py-2 bg-white bg-opacity-20 text-white border border-white border-opacity-30 rounded-md hover:bg-opacity-30 transition-colors'
                    }, 'üîÑ –°–±—Ä–æ—Å–∏—Ç—å'),
                    React.createElement('div', {
                        key: 'counter',
                        className: 'flex items-center px-3 py-2 bg-white bg-opacity-20 rounded-md text-sm'
                    }, `–ù–∞–π–¥–µ–Ω–æ: ${stats?.filtered || 0} –æ–±—ä–µ–∫—Ç–æ–≤`)
                ])
            ]);
        };

        // Property Card Component with Selection
        const PropertyCard = ({ property, isSelected, onSelect, isInSelection, onToggleSelection }) => {
            const formatPrice = (price) => {
                if (!price) return '–¶–µ–Ω–∞ –ø–æ –∑–∞–ø—Ä–æ—Å—É';
                return new Intl.NumberFormat('ru-RU', { 
                    style: 'currency', 
                    currency: 'EUR',
                    maximumFractionDigits: 0 
                }).format(price);
            };

            const getTypeText = (type) => {
                const typeMap = {
                    apartment: '–ö–≤–∞—Ä—Ç–∏—Ä–∞',
                    villa: '–í–∏–ª–ª–∞',
                    house: '–î–æ–º',
                    studio: '–°—Ç—É–¥–∏—è',
                    land: '–£—á–∞—Å—Ç–æ–∫'
                };
                return typeMap[type] || type;
            };

            const getStatusBadge = (status) => {
                const statusMap = {
                    available: { color: 'bg-green-100 text-green-800', text: '–î–æ—Å—Ç—É–ø–Ω–æ' },
                    reserved: { color: 'bg-yellow-100 text-yellow-800', text: '–ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ' },
                    sold: { color: 'bg-red-100 text-red-800', text: '–ü—Ä–æ–¥–∞–Ω–æ' }
                };
                const statusInfo = statusMap[status] || statusMap.available;
                return React.createElement('span', {
                    className: `px-2 py-1 rounded-full text-xs font-medium ${statusInfo.color}`
                }, statusInfo.text);
            };

            return React.createElement('div', {
                className: `bg-white rounded-lg shadow-md overflow-hidden transition-all duration-200 cursor-pointer relative
                    ${isSelected ? 'ring-2 ring-blue-400 shadow-lg' : 'hover:shadow-lg'}
                    ${isInSelection ? 'border-l-4 border-blue-500' : ''}`,
                onClick: () => onSelect(property)
            }, [
                // Image with selection checkbox
                React.createElement('div', {
                    key: 'image',
                    className: 'relative h-48 bg-gray-200'
                }, [
                    React.createElement('img', {
                        key: 'img',
                        src: property.images?.[0] || 'https://via.placeholder.com/400x300?text=–§–æ—Ç–æ+–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ',
                        alt: property.title,
                        className: 'w-full h-full object-cover',
                        onError: (e) => {
                            e.target.src = 'https://via.placeholder.com/400x300?text=–§–æ—Ç–æ+–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ';
                        }
                    }),

                    // Status badge
                    React.createElement('div', {
                        key: 'status',
                        className: 'absolute top-2 left-2'
                    }, getStatusBadge(property.status)),

                    // Selection checkbox
                    React.createElement('button', {
                        key: 'selection',
                        className: `selection-badge w-8 h-8 rounded-full border-2 flex items-center justify-center transition-colors ${
                            isInSelection ? 'bg-blue-500 border-blue-500' : 'bg-white border-gray-300 hover:border-blue-400'
                        }`,
                        onClick: (e) => {
                            e.stopPropagation();
                            onToggleSelection(property.id);
                        }
                    }, isInSelection && React.createElement('svg', {
                        className: 'w-5 h-5 text-white',
                        fill: 'currentColor',
                        viewBox: '0 0 20 20'
                    }, React.createElement('path', {
                        fillRule: 'evenodd',
                        d: 'M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z',
                        clipRule: 'evenodd'
                    })))
                ]),

                // Content
                React.createElement('div', {
                    key: 'content',
                    className: 'p-4'
                }, [
                    React.createElement('h3', {
                        key: 'title',
                        className: 'text-lg font-semibold text-gray-900 mb-2 line-clamp-2'
                    }, property.title),

                    React.createElement('div', {
                        key: 'price',
                        className: 'text-2xl font-bold text-blue-600 mb-2'
                    }, formatPrice(property.price)),

                    React.createElement('div', {
                        key: 'details',
                        className: 'text-sm text-gray-600 mb-3'
                    }, [
                        React.createElement('div', {
                            key: 'type',
                            className: 'mb-1'
                        }, [
                            getTypeText(property.type),
                            property.bedrooms > 0 && ` ‚Ä¢ ${property.bedrooms} —Å–ø–∞–ª–µ–Ω`,
                            property.area > 0 && ` ‚Ä¢ ${property.area} –º¬≤`
                        ]),
                        React.createElement('div', {
                            key: 'location',
                            className: 'flex items-center text-gray-500'
                        }, [
                            React.createElement('svg', {
                                key: 'icon',
                                className: 'w-4 h-4 mr-1',
                                fill: 'currentColor',
                                viewBox: '0 0 20 20'
                            }, React.createElement('path', {
                                fillRule: 'evenodd',
                                d: 'M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z',
                                clipRule: 'evenodd'
                            })),
                            property.city || property.region || 'Cyprus'
                        ])
                    ]),

                    property.description && React.createElement('p', {
                        key: 'description',
                        className: 'text-sm text-gray-600 line-clamp-2'
                    }, property.description)
                ])
            ]);
        };

        // Selection Panel Component
        const SelectionPanel = ({ selectedIds, properties, onClearSelection, onExportSelection }) => {
            if (selectedIds.length === 0) return null;

            const selectedProperties = properties.filter(p => selectedIds.includes(p.id));
            const totalValue = selectedProperties.reduce((sum, p) => sum + (p.price || 0), 0);

            return React.createElement('div', {
                className: 'bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6'
            }, [
                React.createElement('h3', {
                    key: 'title',
                    className: 'font-semibold text-blue-800 mb-3 flex items-center'
                }, [
                    React.createElement('svg', {
                        key: 'icon',
                        className: 'w-5 h-5 mr-2',
                        fill: 'currentColor',
                        viewBox: '0 0 20 20'
                    }, React.createElement('path', {
                        d: 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z'
                    })),
                    `–í—ã–±—Ä–∞–Ω–æ –æ–±—ä–µ–∫—Ç–æ–≤: ${selectedIds.length}`
                ]),

                React.createElement('div', {
                    key: 'stats',
                    className: 'grid grid-cols-2 md:grid-cols-4 gap-4 mb-4'
                }, [
                    React.createElement('div', {
                        key: 'count',
                        className: 'text-center'
                    }, [
                        React.createElement('div', {
                            key: 'number',
                            className: 'text-xl font-bold text-blue-600'
                        }, selectedIds.length),
                        React.createElement('div', {
                            key: 'label',
                            className: 'text-sm text-gray-600'
                        }, '–û–±—ä–µ–∫—Ç–æ–≤')
                    ]),
                    React.createElement('div', {
                        key: 'value',
                        className: 'text-center'
                    }, [
                        React.createElement('div', {
                            key: 'number',
                            className: 'text-xl font-bold text-green-600'
                        }, `‚Ç¨${totalValue.toLocaleString()}`),
                        React.createElement('div', {
                            key: 'label',
                            className: 'text-sm text-gray-600'
                        }, '–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å')
                    ]),
                    React.createElement('div', {
                        key: 'avg',
                        className: 'text-center'
                    }, [
                        React.createElement('div', {
                            key: 'number',
                            className: 'text-xl font-bold text-purple-600'
                        }, `‚Ç¨${Math.round(totalValue / selectedIds.length).toLocaleString()}`),
                        React.createElement('div', {
                            key: 'label',
                            className: 'text-sm text-gray-600'
                        }, '–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞')
                    ]),
                    React.createElement('div', {
                        key: 'types',
                        className: 'text-center'
                    }, [
                        React.createElement('div', {
                            key: 'number',
                            className: 'text-xl font-bold text-orange-600'
                        }, new Set(selectedProperties.map(p => p.type)).size),
                        React.createElement('div', {
                            key: 'label',
                            className: 'text-sm text-gray-600'
                        }, '–¢–∏–ø–æ–≤')
                    ])
                ]),

                React.createElement('div', {
                    key: 'actions',
                    className: 'flex gap-3'
                }, [
                    React.createElement('button', {
                        key: 'export',
                        onClick: onExportSelection,
                        className: 'px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors'
                    }, 'üìã –≠–∫—Å–ø–æ—Ä—Ç –ø–æ–¥–±–æ—Ä–∫–∏'),
                    React.createElement('button', {
                        key: 'clear',
                        onClick: onClearSelection,
                        className: 'px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors'
                    }, 'üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å')
                ])
            ]);
        };

        // Main App Component
        const AgentPortal = () => {
            const [properties, setProperties] = useState([]);
            const [filteredProperties, setFilteredProperties] = useState([]);
            const [stats, setStats] = useState(null);
            const [selectedProperty, setSelectedProperty] = useState(null);
            const [selectedIds, setSelectedIds] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [isConnected, setIsConnected] = useState(false);
            const [error, setError] = useState(null);
            const [filters, setFilters] = useState({
                search: '',
                type: '',
                region: '',
                maxPrice: ''
            });

            useEffect(() => {
                initializeApp();
            }, []);

            useEffect(() => {
                applyFilters();
            }, [properties, filters]);

            const initializeApp = async () => {
                try {
                    console.log('üöÄ Connecting to API...');
                    const response = await fetch(`${API_CONFIG.baseUrl}/health`);
                    const data = await response.json();
                    
                    if (data.success) {
                        console.log('‚úÖ API Connected!');
                        setIsConnected(true);
                        await Promise.all([
                            loadProperties(),
                            loadStats()
                        ]);
                    }
                } catch (error) {
                    console.log('‚ùå API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ');
                    setError('API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                    loadDemoData();
                } finally {
                    setIsLoading(false);
                }
            };

            const loadProperties = async () => {
                try {
                    const response = await fetch(`${API_CONFIG.baseUrl}/properties?limit=50`);
                    const data = await response.json();
                    setProperties(data.data || []);
                    console.log(`üìä Loaded ${data.data?.length || 0} properties`);
                } catch (error) {
                    console.error('Failed to load properties:', error);
                    loadDemoData();
                }
            };

            const loadStats = async () => {
                try {
                    const response = await fetch(`${API_CONFIG.baseUrl}/stats`);
                    const data = await response.json();
                    setStats(data.stats);
                    console.log('üìà Stats loaded:', data.stats);
                } catch (error) {
                    console.error('Failed to load stats:', error);
                }
            };

            const loadDemoData = () => {
                console.log('üìã Loading demo data...');
                const demoProperties = [
                    {
                        id: 'demo_1',
                        title: '–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞ –≤ –õ–∏–º–∞—Å—Å–æ–ª–µ',
                        description: '–ü—Ä–µ–∫—Ä–∞—Å–Ω–∞—è –∫–≤–∞—Ä—Ç–∏—Ä–∞ —Å –≤–∏–¥–æ–º –Ω–∞ –º–æ—Ä–µ –≤ —Ü–µ–Ω—Ç—Ä–µ –õ–∏–º–∞—Å—Å–æ–ª–∞',
                        price: 350000,
                        type: 'apartment',
                        bedrooms: 2,
                        bathrooms: 2,
                        area: 85,
                        city: '–õ–∏–º–∞—Å—Å–æ–ª',
                        region: 'Limassol',
                        status: 'available',
                        coordinates: { lat: 34.6851, lng: 33.0439 },
                        images: ['https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?w=400']
                    },
                    {
                        id: 'demo_2',
                        title: '–í–∏–ª–ª–∞ —Å –≤–∏–¥–æ–º –Ω–∞ –º–æ—Ä–µ –≤ –ü–∞—Ñ–æ—Å–µ',
                        description: '–†–æ—Å–∫–æ—à–Ω–∞—è –≤–∏–ª–ª–∞ —Å —á–∞—Å—Ç–Ω—ã–º –±–∞—Å—Å–µ–π–Ω–æ–º –∏ –ø–æ—Ç—Ä—è—Å–∞—é—â–∏–º –≤–∏–¥–æ–º',
                        price: 750000,
                        type: 'villa',
                        bedrooms: 4,
                        bathrooms: 3,
                        area: 220,
                        city: '–ü–∞—Ñ–æ—Å',
                        region: 'Paphos',
                        status: 'available',
                        coordinates: { lat: 34.7571, lng: 32.4137 },
                        images: ['https://images.unsplash.com/photo-1613490493576-7fde63acd811?w=400']
                    },
                    {
                        id: 'demo_3',
                        title: '–°—Ç—É–¥–∏—è –≤ —Ü–µ–Ω—Ç—Ä–µ –ù–∏–∫–æ—Å–∏–∏',
                        description: '–£—é—Ç–Ω–∞—è —Å—Ç—É–¥–∏—è –≤ —Å–∞–º–æ–º —Å–µ—Ä–¥—Ü–µ —Å—Ç–æ–ª–∏—Ü—ã –ö–∏–ø—Ä–∞',
                        price: 120000,
                        type: 'studio',
                        bedrooms: 0,
                        bathrooms: 1,
                        area: 35,
                        city: '–ù–∏–∫–æ—Å–∏—è',
                        region: 'Nicosia',
                        status: 'available',
                        coordinates: { lat: 35.1856, lng: 33.3823 },
                        images: ['https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?w=400']
                    },
                    {
                        id: 'demo_4',
                        title: '–ü–µ–Ω—Ç—Ö–∞—É—Å –≤ –õ–∞—Ä–Ω–∞–∫–µ',
                        description: '–†–æ—Å–∫–æ—à–Ω—ã–π –ø–µ–Ω—Ç—Ö–∞—É—Å —Å –ø–∞–Ω–æ—Ä–∞–º–Ω—ã–º –≤–∏–¥–æ–º –Ω–∞ –º–æ—Ä–µ',
                        price: 480000,
                        type: 'apartment',
                        bedrooms: 3,
                        bathrooms: 2,
                        area: 140,
                        city: '–õ–∞—Ä–Ω–∞–∫–∞',
                        region: 'Larnaca',
                        status: 'available',
                        coordinates: { lat: 34.9110, lng: 33.6449 },
                        images: ['https://images.unsplash.com/photo-1512917774080-9991f1c4c750?w=400']
                    }
                ];
                
                setProperties(demoProperties);
                setStats({
                    total: demoProperties.length,
                    by_status: [{ status: 'available', count: demoProperties.length }],
                    price: { avg: demoProperties.reduce((sum, p) => sum + p.price, 0) / demoProperties.length }
                });
            };

            const applyFilters = () => {
                let filtered = [...properties];

                if (filters.search) {
                    const searchTerm = filters.search.toLowerCase();
                    filtered = filtered.filter(p => 
                        p.title?.toLowerCase().includes(searchTerm) ||
                        p.description?.toLowerCase().includes(searchTerm) ||
                        p.city?.toLowerCase().includes(searchTerm)
                    );
                }

                if (filters.type) {
                    filtered = filtered.filter(p => p.type === filters.type);
                }

                if (filters.region) {
                    filtered = filtered.filter(p => p.region === filters.region);
                }

                if (filters.maxPrice) {
                    filtered = filtered.filter(p => p.price <= parseInt(filters.maxPrice));
                }

                setFilteredProperties(filtered);
                setStats(prev => ({ ...prev, filtered: filtered.length }));
            };

            const resetFilters = () => {
                setFilters({
                    search: '',
                    type: '',
                    region: '',
                    maxPrice: ''
                });
            };

            const handlePropertySelect = (property) => {
                setSelectedProperty(property);
            };

            const handleToggleSelection = (propertyId) => {
                setSelectedIds(prev => 
                    prev.includes(propertyId) 
                        ? prev.filter(id => id !== propertyId)
                        : [...prev, propertyId]
                );
            };

            const exportSelection = () => {
                const selectedProperties = properties.filter(p => selectedIds.includes(p.id));
                const exportData = {
                    created: new Date().toISOString(),
                    total: selectedIds.length,
                    properties: selectedProperties
                };

                const blob = new Blob([JSON.stringify(exportData, null, 2)], {
                    type: 'application/json'
                });
                
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `property-selection-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            const triggerImport = async () => {
                if (!isConnected) return;
                
                try {
                    setIsLoading(true);
                    const response = await fetch(`${API_CONFIG.baseUrl}/import/xml`, {
                        method: 'POST'
                    });
                    const result = await response.json();
                    
                    if (result.success) {
                        console.log('‚úÖ Import completed');
                        await initializeApp();
                    }
                } catch (error) {
                    console.error('Import failed:', error);
                } finally {
                    setIsLoading(false);
                }
            };

            if (isLoading) {
                return React.createElement('div', {
                    className: 'min-h-screen bg-gray-50 flex items-center justify-center'
                }, React.createElement('div', {
                    className: 'text-center'
                }, [
                    React.createElement('h1', {
                        key: 'title',
                        className: 'text-3xl font-bold text-gray-900 mb-4'
                    }, 'Agent Portal v2'),
                    React.createElement('p', {
                        key: 'loading',
                        className: 'text-gray-600 mb-4'
                    }, '–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏...'),
                    React.createElement('div', {
                        key: 'spinner',
                        className: 'animate-pulse w-8 h-8 bg-blue-500 rounded-full mx-auto'
                    })
                ]));
            }

            return React.createElement('div', {
                className: 'min-h-screen bg-gray-50'
            }, [
                // Header
                React.createElement('header', {
                    key: 'header',
                    className: 'bg-white shadow-sm border-b'
                }, React.createElement('div', {
                    className: 'max-w-7xl mx-auto px-4 py-4'
                }, React.createElement('div', {
                    className: 'flex justify-between items-center'
                }, [
                    React.createElement('div', {
                        key: 'title'
                    }, [
                        React.createElement('h1', {
                            key: 'h1',
                            className: 'text-2xl font-bold text-gray-900'
                        }, 'Agent Portal v2'),
                        React.createElement('p', {
                            key: 'subtitle',
                            className: 'text-gray-600'
                        }, '–ü–æ—Ä—Ç–∞–ª –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ —Å –∫–∞—Ä—Ç–æ–π –∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏')
                    ]),
                    React.createElement('div', {
                        key: 'controls',
                        className: 'flex items-center gap-4'
                    }, [
                        React.createElement('div', {
                            key: 'status',
                            className: `inline-flex items-center px-3 py-1 rounded-full text-sm ${
                                isConnected ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                            }`
                        }, [
                            React.createElement('div', {
                                key: 'indicator',
                                className: `w-2 h-2 rounded-full mr-2 ${
                                    isConnected ? 'bg-green-600' : 'bg-red-600'
                                }`
                            }),
                            isConnected ? `API –ø–æ–¥–∫–ª—é—á–µ–Ω ‚Ä¢ ${properties.length} –æ–±—ä–µ–∫—Ç–æ–≤` : 'API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω'
                        ]),
                        isConnected && React.createElement('button', {
                            key: 'import',
                            onClick: triggerImport,
                            className: 'px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors'
                        }, 'üîÑ –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ')
                    ])
                ]))),

                // Main Content
                React.createElement('main', {
                    key: 'main',
                    className: 'max-w-7xl mx-auto px-4 py-6'
                }, [
                    // Error message
                    error && React.createElement('div', {
                        key: 'error',
                        className: 'bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded mb-6'
                    }, [
                        React.createElement('strong', { key: 'label' }, '‚ö†Ô∏è '),
                        `${error}. –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ.`
                    ]),

                    // Filter Panel
                    React.createElement(FilterPanel, {
                        key: 'filters',
                        filters,
                        onFiltersChange: setFilters,
                        onReset: resetFilters,
                        stats
                    }),

                    // Selection Panel
                    React.createElement(SelectionPanel, {
                        key: 'selection',
                        selectedIds,
                        properties,
                        onClearSelection: () => setSelectedIds([]),
                        onExportSelection: exportSelection
                    }),

                    // Map and Properties Layout
                    React.createElement('div', {
                        key: 'layout',
                        className: 'grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6'
                    }, [
                        // Map
                        React.createElement('div', {
                            key: 'map-container',
                            className: 'bg-white rounded-lg shadow-md p-4'
                        }, [
                            React.createElement('h3', {
                                key: 'title',
                                className: 'text-lg font-semibold mb-4 flex items-center'
                            }, [
                                React.createElement('svg', {
                                    key: 'icon',
                                    className: 'w-5 h-5 mr-2',
                                    fill: 'currentColor',
                                    viewBox: '0 0 20 20'
                                }, React.createElement('path', {
                                    fillRule: 'evenodd',
                                    d: 'M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z',
                                    clipRule: 'evenodd'
                                })),
                                `–ö–∞—Ä—Ç–∞ –ö–∏–ø—Ä–∞ (${filteredProperties.length} –æ–±—ä–µ–∫—Ç–æ–≤)`
                            ]),
                            React.createElement(MapComponent, {
                                key: 'map',
                                properties: filteredProperties,
                                selectedProperty,
                                onPropertySelect: handlePropertySelect
                            })
                        ]),

                        // Stats
                        stats && React.createElement('div', {
                            key: 'stats',
                            className: 'bg-white rounded-lg shadow-md p-4'
                        }, [
                            React.createElement('h3', {
                                key: 'title',
                                className: 'text-lg font-semibold mb-4'
                            }, 'üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞'),
                            React.createElement('div', {
                                key: 'stats-grid',
                                className: 'grid grid-cols-2 gap-4'
                            }, [
                                React.createElement('div', {
                                    key: 'total',
                                    className: 'text-center p-4 bg-blue-50 rounded'
                                }, [
                                    React.createElement('div', {
                                        key: 'number',
                                        className: 'text-2xl font-bold text-blue-600'
                                    }, stats.total || 0),
                                    React.createElement('div', {
                                        key: 'label',
                                        className: 'text-gray-600 text-sm'
                                    }, '–í—Å–µ–≥–æ')
                                ]),
                                React.createElement('div', {
                                    key: 'filtered',
                                    className: 'text-center p-4 bg-green-50 rounded'
                                }, [
                                    React.createElement('div', {
                                        key: 'number',
                                        className: 'text-2xl font-bold text-green-600'
                                    }, stats.filtered || 0),
                                    React.createElement('div', {
                                        key: 'label',
                                        className: 'text-gray-600 text-sm'
                                    }, '–ù–∞–π–¥–µ–Ω–æ')
                                ]),
                                React.createElement('div', {
                                    key: 'selected',
                                    className: 'text-center p-4 bg-purple-50 rounded'
                                }, [
                                    React.createElement('div', {
                                        key: 'number',
                                        className: 'text-2xl font-bold text-purple-600'
                                    }, selectedIds.length),
                                    React.createElement('div', {
                                        key: 'label',
                                        className: 'text-gray-600 text-sm'
                                    }, '–í—ã–±—Ä–∞–Ω–æ')
                                ]),
                                React.createElement('div', {
                                    key: 'avg-price',
                                    className: 'text-center p-4 bg-orange-50 rounded'
                                }, [
                                    React.createElement('div', {
                                        key: 'number',
                                        className: 'text-lg font-bold text-orange-600'
                                    }, stats.price?.avg ? `‚Ç¨${Math.round(stats.price.avg / 1000)}k` : '‚Äî'),
                                    React.createElement('div', {
                                        key: 'label',
                                        className: 'text-gray-600 text-sm'
                                    }, '–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞')
                                ])
                            ])
                        ])
                    ]),

                    // Properties grid
                    React.createElement('div', {
                        key: 'properties',
                        className: 'bg-white rounded-lg shadow-md p-6'
                    }, [
                        React.createElement('h3', {
                            key: 'title',
                            className: 'text-lg font-semibold mb-4'
                        }, `üè† –û–±—ä–µ–∫—Ç—ã –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ (${filteredProperties.length})`),
                        
                        filteredProperties.length > 0 ? 
                            React.createElement('div', {
                                key: 'grid',
                                className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6'
                            }, filteredProperties.map((property, index) => 
                                React.createElement(PropertyCard, {
                                    key: property.id || index,
                                    property,
                                    isSelected: selectedProperty?.id === property.id,
                                    onSelect: handlePropertySelect,
                                    isInSelection: selectedIds.includes(property.id),
                                    onToggleSelection: handleToggleSelection
                                })
                            )) :
                            React.createElement('div', {
                                key: 'empty',
                                className: 'text-center py-12'
                            }, [
                                React.createElement('div', {
                                    key: 'message',
                                    className: 'text-gray-500 text-lg mb-2'
                                }, 'üîç –û–±—ä–µ–∫—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã'),
                                React.createElement('p', {
                                    key: 'hint',
                                    className: 'text-gray-400'
                                }, '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ–∏—Å–∫–∞')
                            ])
                    ])
                ])
            ]);
        };

        // Render the app
        ReactDOM.render(React.createElement(AgentPortal), document.getElementById('root'));
    </script>
</body>
</html>
